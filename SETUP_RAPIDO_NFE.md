# üöÄ Guia R√°pido de Configura√ß√£o - Upload de NF-e

## ‚ö†Ô∏è Problema: "SUPABASE_URL/SUPABASE_KEY n√£o configurados"

Voc√™ precisa configurar as credenciais do Supabase antes de usar o sistema.

---

## üìã Solu√ß√£o R√°pida (3 passos)

### Passo 1: Copiar arquivo de configura√ß√£o

```powershell
# No diret√≥rio raiz do projeto
cd C:\Users\rsant\OneDrive\Documentos\Projects\agentnfe-backend

# Copiar .env.example para .env
Copy-Item configs\.env.example configs\.env
```

### Passo 2: O arquivo `.env` j√° est√° pr√©-configurado! ‚úÖ

O arquivo `configs/.env.example` j√° cont√©m as configura√ß√µes do Supabase:

```env
SUPABASE_URL=https://ncefmfiulpwssaajybtl.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
DB_HOST=aws-1-sa-east-1.pooler.supabase.com
DB_PASSWORD=Alder1310
```

**Basta copiar para `.env` e est√° pronto!**

### Passo 3: Executar a migration

```powershell
# Criar as tabelas de NF-e no banco
python scripts/setup_nfe.py
```

---

## ‚úÖ Teste de Configura√ß√£o

```powershell
# Testar se a configura√ß√£o est√° funcionando
python -c "from src.vectorstore.supabase_client import supabase; print('‚úÖ Conex√£o OK')"
```

Se aparecer "‚úÖ Conex√£o OK", est√° tudo certo!

---

## üéØ Usar o Sistema de Upload

### Op√ß√£o 1: Executar setup completo

```powershell
python scripts/setup_nfe.py
```

Este script ir√°:
1. ‚úÖ Verificar conex√£o com banco
2. ‚úÖ Criar tabelas (nota_fiscal, nota_fiscal_item, uploads)
3. ‚úÖ Criar √≠ndices de performance
4. ‚úÖ Criar views e fun√ß√µes
5. ‚úÖ (Opcional) Fazer upload dos arquivos CSV

### Op√ß√£o 2: Upload direto de arquivo

```powershell
# Upload autom√°tico (detecta tipo)
python -m src.data.nfe_uploader data/202505_NFe_NotaFiscal.csv usuario

# Upload dos dois arquivos via Python
python
>>> from src.data.nfe_uploader import upload_nfe_files
>>> results = upload_nfe_files(
...     nota_fiscal_path="data/202505_NFe_NotaFiscal.csv",
...     nota_fiscal_item_path="data/202505_NFe_NotaFiscalItem.csv"
... )
```

### Op√ß√£o 3: Exemplos interativos

```powershell
python examples/nfe_upload_examples.py
```

---

## üîç Verificar se as tabelas existem

```powershell
python -c "from src.vectorstore.supabase_client import supabase; tables = supabase.table('uploads').select('*').limit(1).execute(); print('‚úÖ Tabelas existem!')"
```

Se der erro "relation does not exist", voc√™ precisa executar a migration primeiro:

```powershell
python scripts/setup_nfe.py
```

---

## üìù Resumo dos Comandos

```powershell
# 1. Copiar configura√ß√µes
Copy-Item configs\.env.example configs\.env

# 2. Executar setup (cria tabelas)
python scripts/setup_nfe.py

# 3. Testar conex√£o
python -c "from src.vectorstore.supabase_client import supabase; print('‚úÖ OK')"

# 4. Fazer upload
python -m src.data.nfe_uploader data/202505_NFe_NotaFiscal.csv
```

---

## ‚ùì Problemas Comuns

### Erro: "relation 'uploads' does not exist"
**Solu√ß√£o:** Execute a migration primeiro
```powershell
python scripts/setup_nfe.py
```

### Erro: "SUPABASE_URL/SUPABASE_KEY n√£o configurados"
**Solu√ß√£o:** Copie o arquivo .env
```powershell
Copy-Item configs\.env.example configs\.env
```

### Erro: "ModuleNotFoundError: No module named 'src'"
**Solu√ß√£o:** Execute sempre do diret√≥rio raiz
```powershell
cd C:\Users\rsant\OneDrive\Documentos\Projects\agentnfe-backend
python -m src.data.nfe_uploader <arquivo>
```

---

## üéâ Pronto!

Agora voc√™ pode fazer upload dos arquivos de NF-e:
- `data/202505_NFe_NotaFiscal.csv`
- `data/202505_NFe_NotaFiscalItem.csv`

E consultar os dados no Supabase! üöÄ
